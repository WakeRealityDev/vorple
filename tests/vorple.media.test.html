<!DOCTYPE html>
<html>
<head>
	<script src="../lib/jquery-1.6.4.min.js"></script>
	<script src="../lib/jquery.jplayer.min.js"></script>
	
	<script src="../src/vorple.core.js"></script>
	<script src="../src/vorple.html.js"></script>
	<script src="../src/vorple.cookie.js"></script>
	<script src="../src/vorple.media.js"></script>	
	<script type="text/javascript" src="lib/qunit-git.js"></script>
	
	<link rel="stylesheet" href="lib/qunit-git.css" type="text/css" media="screen" />

<script>

$(document).ready(function(){
	module( 'media' );
    
    vorple.media.defaults.swfPath = '../lib';
    vorple.media.defaults.audioPath = '../stories/demo/media/audio';
    vorple.media.defaults.videoPath = '../stories/demo/media/video';

    vorple.core.init();

 //   $( "#players" ).append( vorple.media.createPlayer() ).css( 'height', '0px' )
	//    .css( 'overflow', 'hidden' );
    
    test( 'Container', function() {
        var $playerContainer = $( '<div id="playerContainer"></div>' );
        var $mainContainer = $( '<div id="mainContainer"></div>' );
        
        $( 'body' ).append( $playerContainer );
        $( 'body' ).append( $mainContainer );

        var $container1 = vorple.media._createPlayer();

        ok(
            $( '#'+vorple.media.defaults.mainContainer ).children().length == 1,
            'player created in main container'
        );
              
        equal(
            vorple.media._createPlayer( { element: $playerContainer } ),
        	$playerContainer,
            'jQuery object as container returned as is'
        );     

        equal(
            vorple.media._createPlayer( { element: 'playerContainer' } ).attr( 'id' ),
            'playerContainer',
            'string as container returned as a jQuery object'
        );

        equal(
			vorple.media._createPlayer( { parent: $mainContainer } ).parent().attr( 'id' ),
			'mainContainer',
			'jQuery main container'
		); 


        equal(
			vorple.media._createPlayer( { parent: 'secondMainContainer' } ).parent().attr( 'id' ),
			'secondMainContainer',
			"string main container, doesn't exist"
		); 

        equal(
			vorple.media._createPlayer( { parent: 'mainContainer' } ).parent().attr( 'id' ),
			'mainContainer',
			"string main container, existing"
		); 
            
    } );


    test( 'image', function() {
        equal(
            vorple.media.image( 'foo.jpg' ),
            '<img src="media/image/foo.jpg" />'
        );
        
        equal(
            vorple.media.image( '/foo.jpg' ),
            '<img src="/foo.jpg" />'
        );

        var $img = $( vorple.media.image( 'foo.jpg', { classes: 'baz', id: 'fizz' } ) );
        ok(
            $img.hasClass( 'baz' ) && $img.attr( 'id' ) == 'fizz',
            'image options'
        )
    });
    
 /*   
    test( 'Music', function() {
        expect( 2 );
        stop();
		var container = vorple.media.play( {
		        mp3: "SongOfOld.mp3",
		        oga: "2025.ogg"
			}, { 
				onReady: function() {
//		            ok( confirm( 'Do you hear music?' ), "Music started" );
		    //	    container.jPlayer( 'stop' );
//		    	    ok( confirm( 'Did the music stop?' ), "Music stopped" ); 
//		    		start();
				}
	        } 
	    );
     } ); 
*/

	test( 'preloadImage', function() {
		vorple.media.defaults.imagePath = '../stories/everything/media/image';
		
		equal(
			typeof vorple.media.preloadImage( 'dodo.jpg' ),
			'object',
			'one image'
		);

		equal(
			typeof vorple.media.preloadImage( [ 'dodo.jpg', 'puppy,jpg' ] ),
			'object',
			'two images'
		);
	}); 

    test( 'YouTube', function() {
        var $youtube = $( vorple.media.youtube( 'foo', { width: 100, height: 200 } ) );
        var url = $youtube.find( 'param[name="movie"]' ).attr( 'value' );
        var params = url.split( '&' );
        var firstParam = params[ 0 ].split( '?' );
        var cleanUrl = firstParam[ 0 ];
        params.push( firstParam[ 1 ] );
        

       	equal(
        	cleanUrl.indexOf( 'http://www.youtube.com/v/' ),
        	0,
        	'correct url'
        );

       	ok(
           	$.inArray( 'foo', cleanUrl.split( '/' ) ),
           	'correct video id'
        );
        
        equal( 
           	$youtube.attr( 'width' ),
			100,
			'object attributes'
       	);
    });

});
</script>
  
</head>
<body>
  <h1 id="qunit-header">Vorple media</h1>
 <h2 id="qunit-banner"></h2>
 <div id="qunit-testrunner-toolbar"></div>
 <h2 id="qunit-userAgent"></h2>
 <ol id="qunit-tests"></ol>
 <div id="qunit-fixture">test markup, will be hidden</div>
</body>
</html>
