<!DOCTYPE html>
<html>
<head>
	<script type="text/javascript" src="../lib/jquery-1.7.1.min.js"></script>
	
	<script type="text/javascript" src="../src/vorple.core.js"></script>
	<script type="text/javascript" src="lib/qunit-git.js"></script>
	
	<link rel="stylesheet" href="lib/qunit-git.css" type="text/css" media="screen" />

<script>
var errorCallback = false;

$(document).ready(function(){

    module( 'core' );

    test( 'init', function() {
        expect( 1 );
        
        $( document ).bind( 'vorpleInit', function() {
            ok( true, 'Init hook triggered' );
        } );
        
        vorple.core.init();
    } );

    
    /** 
     * There are more engine tests in vorple.undum.test.html
     */
    test( 'engine', function() {
       	equal(
   	       	vorple.core.engine(),
   	       	null,
   	       	'no engine loaded'
  	    );
       	equal(
   	       	vorple.core.engine( 'undum' ),
   	       	false,
   	       	'testing for undum before it is loaded'
  	    );  	    
    } );

    test( 'generateId', function() {
        // This is of course way too small sample guarantee that the ids would 
        // always be unique (and in theory we can never be sure), but it'll be 
        // enough to see if rapid generation could produce same ids.
        var ids = [];
        var allUnique = true;
        var noneStartsWithNumber = true;
        
        for( var i = 0; i < 1000; ++i ) {
            var id = vorple.core.generateId();
            
            for( var j = 0; j < ids.length; ++j ) {
            	if( ids[ j ] == id ) {
                	allUnique = false;
            	}    
            }

            // charcode 48 == '0', 57 == '9'
            if( id.charCodeAt( 0 ) >= 48 && id.charCodeAt( 0 ) <= 57 ) {
                noneStartsWithNumber = false;
            }
            
            ids.push( id );
        }

        ok( allUnique, 'All generated ids unique after ' + i + ' iterations' );
        ok( noneStartsWithNumber, 'No id starts with a number' );

        equal(
            vorple.core.generateId().length,
            32,
            'Default length 32'
        );
        
        equal(
            vorple.core.generateId( 10 ).length,
            10,
            'Custom length'
        );
         
    } );

    test( 'requireRelease', function() {
        var currentRel = vorple.core.release;

		ok( vorple.core.requireRelease( currentRel - 1 ), 'lower release' );
		ok( vorple.core.requireRelease( currentRel ), 'exact release' );
        raises( function() { vorple.core.requireRelease( currentRel + 1 ) } );

        raises( function() {
            vorple.core.requireRelease( currentRel + 1, 'Wrong release' );
        	},
            function( error ) {
                return ( error.message === "Wrong release" );
            },
            'custom error message'
        );

		ok( vorple.core.requireRelease( [ currentRel, currentRel + 1 ] ), 'with max release' );
		raises( function() { vorple.core.requireRelease( [ currentRel - 2, currentRel - 1 ] ) } );

		var callback = function() {
			errorCallback = true;
		};

		vorple.core.requireRelease( currentRel + 1, callback );
		ok( errorCallback, 'callback' );
		
    } );
    
});


</script>
  
</head>
<body>
  <h1 id="qunit-header">Vorple core</h1>
 <h2 id="qunit-banner"></h2>
 <div id="qunit-testrunner-toolbar"></div>
 <h2 id="qunit-userAgent"></h2>
 <ol id="qunit-tests"></ol>
 <div id="qunit-fixture">test markup, will be hidden</div>
</body>
</html>
