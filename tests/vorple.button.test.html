<!DOCTYPE html>
<html>
<head>
	<script src="../lib/jquery-1.6.4.min.js"></script>
	
	<script src="../src/vorple.core.js"></script>
	<script src="../src/vorple.html.js"></script>
	<script src="../src/vorple.cookie.js"></script>
	<script src="../src/vorple.media.js"></script>
	<script src="../src/vorple.button.js"></script>
	<script type="text/javascript" src="lib/qunit-git.js"></script>
	
	<link rel="stylesheet" href="lib/qunit-git.css" type="text/css" media="screen" />

<script>

$(document).ready(function(){
    vorple.core.init();
    
    module( 'buttons' );
    
    test( 'basic button', function() {
        var button = new vorple.button.Button();
        var $element = $( button.toString() );

        equal(
            $element.toString(),
            '',
            'empty button'
        ); 

        button = new vorple.button.Button( 'Test', { classes: 'foo' } );
        var $element = $( button.toString() );

        $element.appendTo( '#qunit-fixture' );

        equal(
            $element.toString(),
            'Test',
            'text'
        );

        ok( $element.hasClass( 'foo' ), 'classes' );    

        ok( button.isEnabled(), 'Created as enabled' );
        button.disable();
        ok( !button.isEnabled(), 'isEnabled is false after disable' );

        window.eventTest = false;
        
        button = new vorple.button.Button( 'Test', function() {
            window.eventTest = true;
        });

        $element = $( button.toString() );
        $element.appendTo( '#qunit-fixture' ).trigger( 'click' );

        ok( window.eventTest, 'click event attached' );

        window.eventTest = false;
        button.disable();
        $element.trigger( 'click' );
        
        ok( !window.eventTest, 'no click event triggered when disabled' );
    });

    
    test( 'link', function() {
        var button = new vorple.button.Link();
        var $element = $( button.toString() );

        equal(
            $element.toString(),
            '',
            'empty button'
        ); 

        equal(
            $element.attr( 'href' ),
            '#',
            'default href'
        );

        button = new vorple.button.Link( 'Test', { classes: 'foo', href: 'bar' } );
        $element = $( button.toString() );

        $element.appendTo( '#qunit-fixture' );

        equal(
            $element.toString(),
            'Test',
            'text'
        );

        equal(
            $element.attr( 'href' ),
            'bar',
            'href'
        );

        ok( $element.hasClass( 'foo' ), 'classes' );    

        ok( button.isEnabled(), 'Created as enabled' );
        button.disable();
        ok( !button.isEnabled(), 'isEnabled is false after disable' );

        window.eventTest = false;
        
        button = new vorple.button.Link( 'Test', function() {
            window.eventTest = true;
        });

        $element = $( button.toString() );
        $element.appendTo( 'body' ).trigger( 'click' );

        ok( window.eventTest, 'click event attached' );

        window.eventTest = false;
        button.disable();
        $element.trigger( 'click' );
        
        ok( !window.eventTest, 'no click event triggered when disabled' );
    });

    
    test( 'image', function() {
        var button = new vorple.button.Image( 'test.png' );
        var $element = $( button.toString() );

        equal(
            $element.attr( 'src' ),
            vorple.media.defaults.imagePath+'/test.png',
            'src'
        );

        button = new vorple.button.Image( 
            'test.png', 
            { classes: 'foo', disabledImage: '/disabled.png' } 
        );
        $element = $( button.toString() );

        $element.appendTo( '#qunit-fixture' );

        ok( $element.hasClass( 'foo' ), 'classes' );    

        ok( button.isEnabled(), 'Created as enabled' );
        button.disable();
        ok( !button.isEnabled(), 'isEnabled is false after disable' );

		equal( 
			$element.attr( 'src' ),
			'/disabled.png',
			'disabled image'
		);
		
        window.eventTest = false;
        
        button = new vorple.button.Image( 'test.png', function() {
            window.eventTest = true;
        });

        $element = $( button.toString() );
        $element.appendTo( 'body' ).trigger( 'click' );

        ok( window.eventTest, 'click event attached' );

        window.eventTest = false;
        button.disable();
        $element.trigger( 'click' );
        
        ok( !window.eventTest, 'no click event triggered when disabled' );
    });


    module( 'button groups' );

    test( 'create', function() {
        var g = new vorple.button.Group();
        equal( g.toString(), '<div></div>', 'group is empty' );
        ok( g.element.jquery, 'element is a jQuery object' );

        g = new vorple.button.Group( null, { id:'foo', class:'bar' });
        equal( g.element.attr( "id" ), 'foo', 'object container id' );
        ok( g.element.hasClass( 'bar' ), 'object container class' );

        g = new vorple.button.Group( null, '<ul>' );
        equal( g.toString(), '<ul></ul>', 'container element specified as string' );

        g = new vorple.button.Group( '', { tag:'ul' } );
        equal( g.toString(), '<ul></ul>', 'container element specified as tag' );  
        
        g = new vorple.button.Group( null, $( '<ul>' ) );
        equal( g.toString(), '<ul></ul>', 'jquery object as container' );

        g = new vorple.button.Group( '<span>bar</span>' );
        equal( g.toString(), '<div><span>bar</span></div>', 'string content' );

        g = new vorple.button.Group( [ '<span>bar</span>', '<span>baz</span>' ] );
        equal( g.toString(), '<div><span>bar</span><span>baz</span></div>', 'string array content' );

        var button = new vorple.button.template.Basic();
        
        g = new vorple.button.Group( button );
        equal( g.toString(), '<div>'+button.toString()+'</div>', 'button content' );
        
        g = new vorple.button.Group( [ button, '<span>baz</span>' ] );
        equal( g.toString(), '<div>'+button.toString()+'<span>baz</span></div>', 'mixed array content' );

    } );
});
</script>
  
</head>
<body>
  <h1 id="qunit-header">Vorple button</h1>
 <h2 id="qunit-banner"></h2>
 <div id="qunit-testrunner-toolbar"></div>
 <h2 id="qunit-userAgent"></h2>
 <ol id="qunit-tests"></ol>
 <div id="qunit-fixture">test markup, will be hidden</div>
</body>
</html>
