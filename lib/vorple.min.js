var vorple={};
(function(d){vorple.core={release:1,version:1};vorple.core.defaults={};vorple.core.settings={confirmWindowClose:!1,debug:!1};vorple.core._init=function(){d(".vorple-version").html(this.version+"."+this.release);window.onbeforeunload=function(a){if(vorple.core.settings.confirmWindowClose&&!vorple.core.settings.debug){var c;c=!0===vorple.core.settings.confirmWindowClose?"You are about to leave the story. Any unsaved progress will be lost. Are you sure you want to continue?":vorple.core.settings.confirmWindowClose;if(a)a.returnValue=
c;return c}};if("undefined"===typeof window.console)window.console={log:function(){}}};vorple.core.engine=function(a){return"string"===typeof a?"undum"==a?"undefined"!==typeof undum:!1:"undefined"!==typeof undum?"undum":null};vorple.core.generateId=function(a){void 0===a&&(a=32);for(var c="",b=0;b<a;++b)var d=0==b?Math.floor(52*Math.random())+10:Math.floor(62*Math.random()),c=10>d?c+(""+d):36>d?c+String.fromCharCode(d+55):c+String.fromCharCode(d+61);return c};vorple.core.init=function(){this._init();
d(document).trigger("vorpleInit")};vorple.core.requireRelease=function(a,c){var b,e=!1,f;d.isArray(a)?(b=a[0],e=a[1],f=b+"-"+e):f=b=a;if(b>this.release||!1!==e&&e<this.release)switch(typeof c){case "function":c();break;case "string":throw Error(c);default:throw Error("Version mismatch: release "+f+" required, currently running release "+this.release);}return!0}})(jQuery);(function(d){vorple.button={};vorple.button.template={Basic:function(a,c){this.opt=d.extend({},{text:null},a);this.disabledOpt=d.extend({},a,c);this.id="button_"+vorple.core.generateId();this.element=d(vorple.html.tag("button",this.opt.text,this.opt)).addClass(this.id).addClass("vorpleButton basicButton");this.disable=function(){this.element.attr("disabled","disabled")};this.enable=function(){this.element.attr("disabled","")};this.isEnabled=function(){return"disabled"!==this.element.attr("disabled")};
this.html=function(){return vorple.html.$toHtml(this.element)}},Link:function(a,c){this.opt=d.extend({},{text:"",endTag:"always"},a);this.disabledOpt=d.extend({},a,c);this.id="button_"+vorple.core.generateId();this.enabled=!0;var b;if("undefined"!==typeof this.opt.onclick)b=this.opt.onclick,delete this.opt.onclick;this.element=d(vorple.html.tag("span",vorple.html.tag("a",this.opt.text,{href:vorple.html.url(this.opt.url),onclick:b}),this.opt)).addClass(this.id).addClass("vorpleButton linkButton");
this.disable=function(){this.element.html(this.element.children("a").html()).addClass("ex_link");this.enabled=!1};this.enable=function(){this.element.html('<a href="'+vorple.html.url(this.opt.url)+'">'+this.opt.text+"</a>").removeClass("ex_link");this.enabled=!0};this.isEnabled=function(){return this.enabled};this.html=function(){return vorple.html.$toHtml(this.element)}},Image:function(a,c){this.opt=d.extend({},{src:"",endTag:"never"},a);this.id="button_"+vorple.core.generateId();this.disabledOpt=
d.extend({},a,{onclick:""},c);this.enabled=!0;this.disable=function(){vorple.html.replaceAttributes(this.element,this.disabledOpt);this.element.addClass(this.id);this.enabled=!1};this.enable=function(){this.element=d(vorple.html.tag("img",null,this.opt)).addClass(this.id).addClass("vorpleButton imageButton");this.enabled=!0};this.isEnabled=function(){return this.enabled};this.html=function(){return vorple.html.$toHtml(this.element)};this.click=d.noop();this.enable()}};vorple.button.Group=function(a,
c){var b=this;this.content=[];if("object"===d.type(c)||void 0==c||!c)if(void 0!=c&&void 0!=c.jquery)this.element=c;else{if("object"!==d.type(c))c={tag:"div"};else if(void 0==c.tag)c.tag="div";this.element=d(vorple.html.tag(c.tag,null,c,{endTag:"never"}))}else this.element="string"===d.type(c)?d(c):d("<div>");"array"===d.type(a)?this.content=a:void 0!==a&&a&&this.content.push(a);d.each(this.content,function(a,c){b.element.append(c.element)});this.html=function(){for(var a="",b=0;b<this.content.length;++b)switch(d.type(this.content[b])){case "object":a=
void 0!=this.content[b].jquery?a+vorple.html.$toHtml(b):void 0!=this.content[b].html()?a+this.content[b].html():a+this.content[b];break;default:a+=this.content[b]}b=this.element;b.html(a);return vorple.html.$toHtml(b)};this.update=function(){}}})(jQuery);(function(d){vorple.cookie={};vorple.cookie.defaults={expires:365};vorple.cookie.read=function(a,c){var b,e=d.extend({},self.defaults,c).raw?function(a){return a}:decodeURIComponent;return(b=RegExp("(?:^|; )"+encodeURIComponent(a)+"=([^;]*)").exec(document.cookie))?e(b[1]):null};vorple.cookie.remove=function(a){this.write(a,null)};vorple.cookie.write=function(a,c,b){b=d.extend({},this.defaults,b);if(null===c||void 0===c)b.expires=-1;if("number"===typeof b.expires){var e=b.expires,f=b.expires=new Date;
f.setDate(f.getDate()+e)}c=""+c;return document.cookie=[encodeURIComponent(a),"=",b.raw?c:encodeURIComponent(c),b.expires?"; expires="+b.expires.toUTCString():"",b.path?"; path="+b.path:"",b.domain?"; domain="+b.domain:"",b.secure?"; secure":""].join("")}})(jQuery);(function(d){vorple.html={};vorple.html.defaults={allowedTagAttributes:"accesskey,abbr,align,alt,axis,border,cellpadding,cellspacing,char,charoff,class,colspan,dir,disabled,frame,headers,height,href,id,ismap,lang,longdesc,multiple,name,onblur,onclick,ondblclick,onfocus,onkeydown,onkeypress,onkeyup,onmousedown,onmouseout,onmouseover,onmouseup,rel,rev,rowspan,rules,scope,size,src,style,summary,tabindex,target,title,type,usemap,valign,value,width".split(","),endTag:"auto",quotemarks:'"'};vorple.html.$toHtml=
function(a){return"undefined"===typeof a.jquery?"":a.first().clone().wrap("<div></div>").parent().html()};vorple.html.attributes=function(a){var c=this,b=d.extend({},c.defaults,a),e="";"undefined"!==typeof b.classes&&(e=' class="'+b.classes+'"');d.each(b,function(a,g){if(-1<d.inArray(a,b.allowedTagAttributes)||0===a.indexOf("data-"))e+=" "+a+'="'+c.escapeHtmlChars(g)+'"'});b.escape&&(e=c.escapeHtmlChars(e));return e};vorple.html.escapeHtmlChars=function(a){return(a+"").replace(/&/g,"&amp;").replace(/</g,
"&lt;").replace(/>/g,"&gt;").replace(/"/g,"&quot;").replace(/'/g,"&apos;")};vorple.html.link=function(a,c,b){b=d.extend({},{endTag:"always"},b);b.href=a;return this.tag("a",c,b)};vorple.html.p=function(a,c){return vorple.html.tag("p",a,c)};vorple.html.quote=function(a,c){var b,d;if("undefined"==typeof c)c=this.defaults.quotemarks;"string"==typeof c?d=b=c:(b=c[0],d=c[1]);return b+a+d};vorple.html.replaceAttributes=function(a,c){for(var b=a.get(0).attributes,e=0;e<b.length;++e)a.attr(b[e].name,"");
d.each(c,function(b,c){"classes"==b?a.attr("class",c):a.attr(b,c)})};vorple.html.tag=function(a,c,b){var e=d.extend({},this.defaults,b),b="<"+a+this.attributes(e);"always"==e.endTag||"auto"==e.endTag&&"string"===typeof c?("string"!==typeof c&&!c&&(c=""),a=">"+c+"</"+a+">"):a=c?">"+c:"auto"==e.endTag?" />":">";return b+a};vorple.html.url=function(a,c){return("undefined"==typeof a||!a)&&("undefined"==typeof c||!c)?"#":"undefined"==typeof c||!c||a.match(/^[a-zA-Z]*:\/\//)||0===a.indexOf("/")?a:c+"/"+
a}})(jQuery);(function(d){vorple.media={_muted:{music:!1,sound:!1}};vorple.media.defaults={type:"sound",audioPath:"media/audio",imagePath:"media/image",musicPath:"media/music",videoPath:"media/video",muted:!1,mainContainer:"vorple-media",musicContainer:"vorple-music",soundContainer:"vorple-sound",playerSolution:"html, flash",preload:"auto",swfPath:"lib",volume:0.8};vorple.media._createMainContainer=function(a,c){0==d("#"+a).length&&("undefined"===typeof c&&(c=d("body")),c.append(d('<div id="'+a+'"></div>')));
return d("#"+a)};vorple.media._createPlayer=function(a){a=d.extend({},this.defaults,a);if("string"==typeof a.element)return d("#"+a.element);if("object"===d.type(a.element)&&a.element.jquery)return a.element;a="object"===typeof a.parent&&a.parent.jquery?a.parent:"string"===typeof a.parent?this._createMainContainer(a.parent,d("#"+a.mainContainer)):"object"===typeof a.mainContainer&&a.mainContainer.jquery?a.mainContainer:d("#"+a.mainContainer);$element=d('<div id="jplayer_'+vorple.core.generateId()+
'" class="jp-jplayer"></div>');a.append($element);return $element};vorple.media.mute=function(a,c){var b=d.extend({},this.defaults,c);if("undefined"!==typeof a.music)this._muted.music=a.music,d("#"+b.musicContainer).jPlayer(a.music?"mute":"unmute"),d('input.mute[value="music"]').attr("checked",a.music),d('input.unmute[value="music"]').attr("checked",!a.music),a.music?d('input.unmute[value="all"]').attr("checked",!1):d('input.mute[value="all"]').attr("checked",!1);if("undefined"!==typeof a.sound)this._muted.sound=
a.sound,d("#"+b.soundContainer).children().jPlayer(a.sound?"mute":"unmute"),d('input.mute[value="sound"]').attr("checked",a.sound),d('input.unmute[value="sound"]').attr("checked",!a.sound);d('input.mute[value="all"]').attr("checked",this._muted.sound&&this._muted.music);d('input.unmute[value="all"]').attr("checked",!this._muted.sound&&!this._muted.music);vorple.cookie.write("vorpleMute",(this._muted.sound?"1":"0")+","+(this._muted.music?"1":"0"))};vorple.media.muteAll=function(a){"undefined"==typeof a&&
(a=!0);this.mute({music:a,sound:a});return a};vorple.media._play=function(a,c){var b=d.extend({},this.defaults,c),e;if(b.onReady)var f=b.onReady;e="undefined"==typeof b.container||!b.container?this._createPlayer(c):b.container;e.jPlayer("destroy");var g={},h=[];d.each(a,function(a,c){g[a]=vorple.html.url(c,b.audioPath);h.push(a)});e.jPlayer({muted:b.muted,preload:"auto",ready:function(){d(this).jPlayer("setMedia",g).jPlayer("play");d.isFunction(f)&&f()},solution:b.solution,supplied:h.join(", "),swfPath:b.swfPath,
volume:b.volume});return e};vorple.media.image=function(a,c){var b=this.defaults.imagePath;if("object"===typeof c&&"undefined"!==typeof c.imagePath)b=c.imagePath;b=d.extend({},{src:vorple.html.url(a,b)},c);return vorple.html.tag("img",null,b)};vorple.media.playMusic=function(a,c){var b=d.extend({},this.defaults,c);b.audioPath=this.defaults.musicPath;if(this._muted.music)b.muted=!0;$musicContainer=this._createMainContainer(b.musicContainer,d("#"+b.mainContainer));b.container=$musicContainer;return this._play(a,
b)};vorple.media.playSound=function(a,c){if(!vorple.core.engine("undum")||undum.isInteractive()){var b=d.extend({},this.defaults,c);if(this._muted.sound)b.muted=!0;$container=this._createMainContainer(b.soundContainer,d("#"+b.mainContainer));b.mainContainer=$container;b=this._play(a,b);b.bind(d.jPlayer.event.ended,function(){d(this).jPlayer("destroy")});return b}};vorple.media.preloadImage=function(a,c){var b=d.extend({},this.defaults,c);if("string"==typeof a){var e=new Image;e.src=vorple.html.url(a,
b.imagePath);return e}if(d.isArray(a)){var f=[];d.each(a,function(){var a=new Image;a.src=vorple.html.url(this,b.imagePath);f.push(a)});return f}throw Error("Illegal file type given to the image preloader (only String and Array allowed)");};vorple.media.stopAll=function(){this.stopMusic();this.stopSounds()};vorple.media.stopMusic=function(){d("#"+this.defaults.musicContainer).jPlayer("destroy")};vorple.media.stopSounds=function(){d("#"+this.defaults.soundContainer).children().jPlayer("destroy")};
vorple.media.toggleMute=function(a){var c=this,b=a,e=[];"string"==typeof a&&(b=[a]);var f={};d.each(b,function(a,b){f[b]=!c._muted[b];e.push(!c._muted[b])});c.mute(f);return"string"==typeof a?e[0]:e};vorple.media.youtube=function(a,c){var b=d.extend({},this.defaults.youtube,c),e="http://www.youtube.com/v/"+a+"?version=3",f=d.param(b.parameters);f&&(e+="&"+f);return'<object width="'+b.width+'" height="'+b.height+'"><param name="movie" value="'+e+'"></param><param name="allowScriptAccess" value="always"></param><embed src="'+
e+'" type="application/x-shockwave-flash" allowscriptaccess="always" width="'+b.width+'" height="'+b.height+'"></embed></object>'};vorple.media.defaults.youtube={width:640,height:390,parameters:{autoplay:"1",controls:"0",disablekb:"1",modestbranding:"1",rel:"0"}};d(document).bind("vorpleInit",function(){0==d("#"+vorple.media.defaults.mainContainer).length&&d("body").append(d('<div id="'+vorple.media.defaults.mainContainer+'"></div>'));var a=vorple.cookie.read("vorpleMute");a&&(a=a.split(","),vorple.media.mute({sound:"1"==
a[0],music:"1"==a[1]}));d(document).delegate("input.mute","change",function(){var a=d(this);if("all"==a.val())vorple.media.muteAll(a.is(":checked"));else{var b={};b[a.val()]=a.is(":checked");vorple.media.mute(b)}});d(document).delegate("input.unmute","change",function(){var a=d(this);if("all"==a.val())vorple.media.muteAll(!a.is(":checked"));else{var b={};b[a.val()]=!a.is(":checked");vorple.media.mute(b)}})})})(jQuery);(function(d){vorple.tabs={};vorple.tabs.create=function(a){var c=a;if("object"!=typeof a||!a.jquery)c=d(a);if(!d.tabs)throw Error("jQuery UI tabs is not installed");return c.tabs()}})(jQuery);(function(d){vorple.tooltip={};vorple.tooltip.defaults={show:{event:"mouseenter",ready:!1},content:{attr:"title"},position:{my:"bottom left",at:"top center"},overwrite:!1,delay:3E3,duration:1E4};vorple.tooltip._create=function(a,c){var b=d.extend({},this.defaults,c),e=d(a);!b.content&&e.attr(b.content.attr);b.content&&e.qtip(b);return e};vorple.tooltip.enable=function(a,c){var b=this,e=d.extend(!0,{},b.defaults,{show:{ready:!0,event:b.defaults.show.event}},c);return d(document).delegate(a,e.show.event,
function(){b._create(this,e)},event)};vorple.tooltip.show=function(a,c,b){"undefined"===typeof c&&(c=!0);var e=d.extend({},this.defaults,{show:{ready:!1,event:!1},hide:{event:!1},content:{text:c},events:{hide:function(a,b){b.destroy()}}},b),f=this._create(a,e);return setTimeout(function(){0<f.length&&(f.qtip("show"),setTimeout(function(){0<f.length&&f.qtip("hide")},e.duration))},e.delay)}})(jQuery);(function(d){vorple.undum={};vorple.undum.settings={allDisposable:!1,disposableLinks:[],disposableExceptions:[]};vorple.undum._afterTurnTasks=function(a,c,b,e){var f=this;f.settings.allDisposable?-1==d.inArray(e,f.settings.disposableExceptions)&&f.dispose(e):-1<d.inArray(e,f.settings.disposableLinks)&&f.dispose(e);d.each(undum.game._disposedLinks,function(a,b){f._removeDisposed(b)});f._enforceUnique()};vorple.undum._enforceUnique=function(){d("#content").find("a").each(function(a,c){var b=d(c),e=
b.attr("href"),f=!1;b.hasClass("unique")&&d('#content a[href="'+e+'"]').each(function(a,b){var c=d(b);c.hasClass("unique")&&!f?f=!0:c.replaceWith(d("<span>").html(c.html()))})})};vorple.undum._removeDisposed=function(a){d("a[href$='"+a+"'], a[href='"+a+"']").each(function(a,b){var e=d(b);e.replaceWith(d("<span>").addClass("ex_link").html(e.html()))})};vorple.undum.afterActionTrigger=function(a,c,b,d){this._afterTurnTasks(a,c,b,d);return!1};vorple.undum.afterEnterTrigger=function(a,c,b,d){this._afterTurnTasks(a,
c,b,d);return!1};vorple.undum.dispose=function(){var a=this;d.each(arguments,function(c,b){if(d.isArray(b))d.each(b,function(b,c){a.dispose(c)});else if(!a.isDisposed(b)){var e=b.split("/");undum.game._disposedLinks.push(e[e.length-1]);a._removeDisposed(b)}})};vorple.undum.isDisposed=function(a){return-1<d.inArray(a,undum.game._disposedLinks)};vorple.undum.reactivate=function(){var a=this;d.each(arguments,function(c,b){if(d.isArray(b))d.each(b,function(b,c){a.reactivate(c)});else{var e=b.split("/"),
e=d.inArray(e[e.length-1],undum.game._disposedLinks);-1<e&&undum.game._disposedLinks.splice(e,1)}})};d(document).bind("vorpleInit",function(){if(vorple.core.engine("undum")){if(!undum.game.afterEnter)undum.game.afterEnter=function(a,c,b,d){return vorple.undum.afterEnterTrigger(a,c,b,d)};if(!undum.game.afterAction)undum.game.afterAction=function(a,c,b,d){return vorple.undum.afterActionTrigger(a,c,b,d)};if("undefined"===typeof undum.game._disposedLinks)undum.game._disposedLinks=[]}})})(jQuery);
